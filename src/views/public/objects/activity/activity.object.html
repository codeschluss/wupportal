<main>
  <h2 class="mat-headline">
    {{ item.name }}
    <small>
      <i18n i18n="@@by">by</i18n>
      <a [routerLink]="['/', 'organisations', item.organisation.id]">
        {{ item.organisation.name }}
      </a>
      <i18n i18n="@@at">at</i18n>
      <a
        [queryParams]="{ suburbs: item.address.suburb.id }"
        [routerLink]="['/', 'activities']">
        {{ item.address.place }} {{ item.address.suburb.name }}
      </a>
    </small>
  </h2>
  <mat-divider></mat-divider>
  <nav>
    <follow-piece [item]="item"></follow-piece>
    <share-piece [item]="item"></share-piece>
    <like-piece [item]="item"></like-piece>
    <span [style.flexGrow]="1"></span>
    <time-piece [item]="item"></time-piece>
  </nav>
  <mat-divider></mat-divider>
  <section>
    <marked-component [data]="item.description"></marked-component>
    <aside>
      <expand-component #details
        (changed)="$event && expanded(details)">
        <ng-template #expandHeader>
          <icon-component icon="map-marker-alt"></icon-component>
          <i18n i18n="@@details">details</i18n>
        </ng-template>
        <ng-template #expandContent>
          <table>
            <tr>
              <td [style.verticalAlign]="'top'">
                <i18n i18n="@@address">address</i18n>
              </td>
              <td>
                  {{ item.address.street }}
                  {{ item.address.houseNumber }}
                  <br>
                  {{ item.address.postalCode }}
                  {{ item.address.place }}
                  {{ item.address.suburb.name }}
              </td>
            </tr>
            <ng-container *ngIf="item.phone">
              <tr>
                <td><i18n i18n="@@phone">phone</i18n></td>
                <td>
                  <a mat-button target="_blank" [href]="'tel:' + item.phone">
                    <icon-component icon="phone"></icon-component>
                    {{ item.phone }}
                  </a>
                </td>
              </tr>
            </ng-container>
            <ng-container *ngIf="item.mail">
              <tr>
                <td><i18n i18n="@@email">email</i18n></td>
                <td>
                  <a mat-button target="_blank" [href]="'mailto:' + item.mail">
                    <icon-component icon="envelope"></icon-component>
                    {{ item.mail }}
                  </a>
                </td>
              </tr>
            </ng-container>
            <tr>
              <td><i18n i18n="@@category">category</i18n></td>
              <td>
                <mat-chip-list>
                  <mat-chip
                    class="mat-body"
                    [queryParams]="{ categories: item.category.id }"
                    [routerLink]="['/', 'activities']"
                    [style.borderColor]="item.category.color">
                    {{ item.category.name }}
                  </mat-chip>
                </mat-chip-list>
              </td>
            </tr>
            <tr>
              <td><i18n i18n="@@suburb">suburb</i18n></td>
              <td>
                <a mat-button
                  [queryParams]="{ suburbs: item.address.suburb.id }"
                  [routerLink]="['/', 'activities']">
                  <icon-component icon="city"></icon-component>
                  {{ item.address.suburb.name }}
                </a>
              </td>
            </tr>
            <ng-container *ngIf="item.targetGroups?.length">
              <tr>
                <td><i18n i18n="@@targetGroups">targetGroups</i18n></td>
                <td>
                  <ng-container *ngFor="let targetGroup of item.targetGroups">
                    <a mat-button
                      [queryParams]="{ targetgroups: targetGroup.id }"
                      [routerLink]="['/', 'activities']">
                      <icon-component icon="users"></icon-component>
                      {{ targetGroup.name }}
                    </a>
                  </ng-container>
                </td>
              </tr>
            </ng-container>
          </table>
        </ng-template>
      </expand-component>
      <ng-container *ngIf="item.images">
        <expand-component #images
          (changed)="$event && expanded(images)">
          <ng-template #expandHeader>
            <icon-component icon="image"></icon-component>
            <i18n i18n="@@images">images</i18n>
            <small>({{ item.images.length }})</small>
          </ng-template>
          <ng-template #expandContent>
            <ng-container *ngFor="let image of item.images">
              <figure>
                <content
                  [alt]="image.name"
                  [style.backgroundImage]="image.source"
                  [title]="image.name">
                </content>
              </figure>
            </ng-container>
          </ng-template>
        </expand-component>
      </ng-container>
      <ng-container *ngIf="item.schedules">
        <expand-component #schedules
          (changed)="$event && expanded(schedules)">
          <ng-template #expandHeader>
            <icon-component icon="history"></icon-component>
            <i18n i18n="@@schedules">schedules</i18n>
            <small>({{ item.schedules.length }})</small>
          </ng-template>
          <ng-template #expandContent>
            <section>
              <calendar-component
                [items]="item.schedules"
                [name]="item.name"
                (changed)="schedule = $event">
              </calendar-component>
              <mat-divider></mat-divider>
              <aside>
                <ng-container *ngIf="schedule">
                  <i18n i18n="@@selectedSchedule">selectedSchedule</i18n>
                  <time>{{ schedule.datetime }}</time>
                </ng-container>
                <ng-container *ngIf="!schedule">
                  <i18n i18n="@@nextSchedule">nextSchedule</i18n>
                  <time>{{ item.scheduled?.datetime }}</time>
                </ng-container>
              </aside>
            </section>
          </ng-template>
        </expand-component>
      </ng-container>
      <expand-component #mapview
        (changed)="$event && reloader(mapview)">
        <ng-template #expandHeader>
          <icon-component icon="globe"></icon-component>
          <i18n i18n="@@mapview">mapview</i18n>
        </ng-template>
        <ng-template #expandContent>
          <iframe #frame [src]="source"></iframe>
        </ng-template>
      </expand-component>
      <expand-component #organisation
        (changed)="$event && expanded(organisation)">
        <ng-template #expandHeader>
          <icon-component icon="at"></icon-component>
          <i18n i18n="@@organisation">organisation</i18n>
        </ng-template>
        <ng-template #expandContent>
          <organisation-card [item]="item.organisation"></organisation-card>
        </ng-template>
      </expand-component>
      <ng-container *ngIf="item.blogposts">
        <expand-component #blogposts
          (changed)="$event && expanded(blogposts)">
          <ng-template #expandHeader>
            <icon-component icon="at"></icon-component>
            <i18n i18n="@@blogposts">blogposts</i18n>
            <small>({{ item.blogposts.length }})</small>
          </ng-template>
          <ng-template #expandContent>
            <ng-container *ngFor="let blogpost of item.blogposts">
              <blogpost-card [item]="blogpost"></blogpost-card>
            </ng-container>
          </ng-template>
        </expand-component>
      </ng-container>
    </aside>
  </section>
</main>
