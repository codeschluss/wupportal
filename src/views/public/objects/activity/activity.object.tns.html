<scroll-view class="topoff">
  <stack-layout>
    <grid-layout>
      <label textWrap="true">
        <FormattedString>
          <span [text]="item.name"></span>
          <span class="small" [text]="' ' + string('by') + ' '"></span>
          <span class="small" [text]="item.organisation.name"></span>
          <span class="small" [text]="' ' + string('at') + ' '"></span>
          <span class="small" [text]="item.address.place + ' '"></span>
          <span class="small" [text]="item.address.suburb.name"></span>
        </FormattedString>
      </label>
    </grid-layout>
    <flexbox-layout>
      <share-piece [item]="item"></share-piece>
      <like-piece [item]="item"></like-piece>
      <label flexGrow="1"></label>
      <time-piece [item]="item"></time-piece>
    </flexbox-layout>
    <stack-layout>
      <marked-component [data]="item.description"></marked-component>
      <expand-component #details
        class="expand-component"
        (changed)="$event && expanded(details)">
        <ng-template #expandHeader>
          <icon-component icon="at"></icon-component>
          <i18n i18n="@@details" unit="details"></i18n>
        </ng-template>
        <ng-template #expandContent>
          <stack-layout class="detail">
            <i18n i18n="@@address" unit="address" verticalAlignment="top">
            </i18n>
            <stack-layout>
              <label>
                <FormattedString>
                  <span [text]="item.address.street + ' '"></span>
                  <span [text]="item.address.houseNumber"></span>
                </FormattedString>
              </label>
              <label>
                <FormattedString>
                  <span [text]="item.address.postalCode + ' '"></span>
                  <span [text]="item.address.place + ' '"></span>
                  <span [text]="item.address.suburb.name"></span>
                </FormattedString>
              </label>
            </stack-layout>
          </stack-layout>
          <ng-container *ngIf="item.phone">
            <stack-layout class="detail">
              <i18n i18n="@@phone" unit="phone"></i18n>
              <stack-layout ripple (tap)="openUrl('tel:' + item.phone)">
                <icon-component icon="phone"></icon-component>
                <label [text]="item.phone"></label>
              </stack-layout>
            </stack-layout>
          </ng-container>
          <ng-container *ngIf="item.mail">
            <stack-layout class="detail">
              <i18n i18n="@@email" unit="email"></i18n>
              <stack-layout ripple (tap)="openUrl('mailto:' + item.mail)">
                <icon-component icon="envelope"></icon-component>
                <label [text]="item.mail"></label>
              </stack-layout>
            </stack-layout>
          </ng-container>
          <stack-layout class="detail">
            <i18n i18n="@@category" unit="category"></i18n>
            <stack-layout ripple
              [borderColor]="item.category.color"
              (tap)="router.navigate(['/', 'activities'],
                { queryParams: { categories: item.category.id } })">
              <label [text]="item.category.name"></label>
            </stack-layout>
          </stack-layout>
          <stack-layout class="detail">
            <i18n i18n="@@suburb" unit="suburb"></i18n>
            <stack-layout ripple
              (tap)="router.navigate(['/', 'activities'],
                { queryParams: { suburbs: item.address.suburb.id } })">
              <icon-component icon="city"></icon-component>
              <label [text]="item.address.suburb.name"></label>
            </stack-layout>
          </stack-layout>
          <ng-container *ngIf="item.targetGroups?.length">
            <stack-layout class="detail">
              <i18n i18n="@@targetGroups" unit="targetGroups"></i18n>
              <stack-layout>
                <ng-container *ngFor="let targetGroup of item.targetGroups">
                  <stack-layout ripple
                    (tap)="router.navigate(['/', 'activities'],
                      { queryParams: { targetgroups: targetGroup.id } })">
                    <icon-component icon="users"></icon-component>
                    <label [text]="targetGroup.name"></label>
                  </stack-layout>
                </ng-container>
              </stack-layout>
            </stack-layout>
          </ng-container>
        </ng-template>
      </expand-component>
      <ng-container *ngIf="item.images">
        <expand-component #images
          class="expand-component"
          (changed)="$event && expanded(images)">
          <ng-template #expandHeader>
            <icon-component icon="image"></icon-component>
            <i18n i18n="@@images" unit="images"></i18n>
            <label [text]="'(' + item.images.length + ')'"></label>
          </ng-template>
          <ng-template #expandContent>
            <scroll-view #scrollImages>
              <flexbox-layout>
                <ng-container *ngFor="let image of item.images">
                  <grid-layout [width]="scrollImages.getActualSize().width">
                    <image [src]="image.nativeSource"></image>
                  </grid-layout>
                </ng-container>
              </flexbox-layout>
            </scroll-view>
          </ng-template>
        </expand-component>
      </ng-container>
      <ng-container *ngIf="item.schedules">
        <expand-component #schedules
          class="expand-component"
          (changed)="$event && expanded(schedules)">
          <ng-template #expandHeader>
            <icon-component icon="history"></icon-component>
            <i18n i18n="@@schedules" unit="schedules"></i18n>
            <label [text]="'(' + item.schedules.length + ')'"></label>
          </ng-template>
          <ng-template #expandContent>
            <calendar-component
              [items]="item.schedules"
              [name]="item.name"
              (changed)="schedule = $event">
            </calendar-component>
            <stack-layout class="datetime">
              <ng-container *ngIf="schedule">
                <i18n i18n="@@selectedSchedule" unit="selectedSchedule"></i18n>
                <label [text]="schedule.datetime"></label>
              </ng-container>
              <ng-container *ngIf="!schedule">
                <i18n i18n="@@nextSchedule" unit="nextSchedule"></i18n>
                <label [text]="item.scheduled?.datetime"></label>
              </ng-container>
            </stack-layout>
          </ng-template>
        </expand-component>
      </ng-container>
      <expand-component #mapview
        class="expand-component"
        (changed)="$event && reloader(mapview)">
        <ng-template #expandHeader>
          <icon-component icon="globe"></icon-component>
          <i18n i18n="@@mapview" unit="mapview"></i18n>
        </ng-template>
        <ng-template #expandContent>
          <web-view #webview [src]="source"></web-view>
        </ng-template>
      </expand-component>
      <expand-component #organisation
        class="expand-component"
        (changed)="$event && expanded(organisation)">
        <ng-template #expandHeader>
          <icon-component icon="at"></icon-component>
          <i18n i18n="@@organisation" unit="organisation"></i18n>
        </ng-template>
        <ng-template #expandContent>
          <organisation-card [item]="item.organisation"></organisation-card>
        </ng-template>
      </expand-component>
      <ng-container *ngIf="item.blogposts">
        <expand-component #blogposts
          class="expand-component"
          (changed)="$event && expanded(blogposts)">
          <ng-template #expandHeader>
            <icon-component icon="at"></icon-component>
            <i18n i18n="@@blogposts" unit="blogposts"></i18n>
            <label [text]="'(' + item.blogposts.length + ')'"></label>
          </ng-template>
          <ng-template #expandContent>
            <scroll-view #scrollBlogposts>
              <flexbox-layout>
                <ng-container *ngFor="let blogpost of item.blogposts">
                  <grid-layout [width]="scrollBlogposts.getActualSize().width">
                    <blogpost-card [item]="blogpost"></blogpost-card>
                  </grid-layout>
                </ng-container>
              </flexbox-layout>
            </scroll-view>
          </ng-template>
        </expand-component>
      </ng-container>
    </stack-layout>
  </stack-layout>
</scroll-view>
