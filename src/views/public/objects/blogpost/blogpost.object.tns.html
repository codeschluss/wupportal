<scroll-view class="topoff">
  <stack-layout>
    <grid-layout>
      <label textWrap="true">
        <FormattedString>
          <span [text]="item.name"></span>
          <span class="small" [text]="' ' + string('by') + ' '"></span>
          <span class="small" [text]="item.author"></span>
          <ng-container *ngIf="item.activity">
            <span class="small" [text]="' ' + string('about') + ' '"></span>
            <span class="small" [text]="item.activity.name"></span>
          </ng-container>
        </FormattedString>
      </label>
    </grid-layout>
    <flexbox-layout>
      <share-piece [item]="item"></share-piece>
      <like-piece [item]="item"></like-piece>
      <label flexGrow="1"></label>
      <time-piece [item]="item"></time-piece>
    </flexbox-layout>
    <stack-layout>
      <marked-compat [data]="item.content"></marked-compat>
      <ng-container *ngIf="item.images">
        <expand-compat #images
          class="expand-compat"
          (changed)="$event && expanded(images)">
          <ng-template #expandHeader>
            <icon-compat icon="image"></icon-compat>
            <i18n i18n="@@images" unit="images"></i18n>
            <label [text]="'(' + item.images.length + ')'"></label>
          </ng-template>
          <ng-template #expandContent>
            <scroll-view #scrollImages>
              <flexbox-layout>
                <ng-container *ngFor="let image of item.images">
                  <grid-layout [width]="scrollImages.getActualSize().width">
                    <image [src]="image.nativeSource"></image>
                  </grid-layout>
                </ng-container>
              </flexbox-layout>
            </scroll-view>
          </ng-template>
        </expand-compat>
      </ng-container>
      <ng-container *ngIf="item.activity">
        <expand-compat #activity
          class="expand-compat"
          (changed)="$event && expanded(activity)">
          <ng-template #expandHeader>
            <icon-compat icon="map-marker-alt"></icon-compat>
            <i18n i18n="@@activity" unit="activity"></i18n>
          </ng-template>
          <ng-template #expandContent>
            <activity-card [item]="item.activity"></activity-card>
          </ng-template>
        </expand-compat>
      </ng-container>
    </stack-layout>
  </stack-layout>
</scroll-view>
