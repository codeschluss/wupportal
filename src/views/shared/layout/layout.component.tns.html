<navbar-compat [title]="name | async">
  <action-item ios.position="right">
    <stack-layout>
      <activity-indicator [busy]="busy | async"></activity-indicator>
      <grid-layout (tap)="drawer.toggle()">
        <icon-compat [icon]="(drawer.visible | async) ? 'arrow-left' : 'bars'">
        </icon-compat>
      </grid-layout>
    </stack-layout>
  </action-item>
</navbar-compat>
<drawer-compat #drawer>
  <ng-template #drawerMain>
    <stack-layout>
      <router-outlet></router-outlet>
    </stack-layout>
  </ng-template>
  <ng-template #drawerMenu>
    <scroll-view>
      <flexbox-layout>
        <image src="res://icon"></image>
        <stack-layout [class.active]="url.startsWith('/search')">
          <icon-compat icon="search"></icon-compat>
          <absolute-layout #search>
            <text-field #input
              returnKeyType="search"
              text="{{ filter() }}"
              (blur)="search.className = input.text ? 'float' : null"
              (focus)="search.className = 'float'"
              (returnPress)="input.text && navigate('/', 'search', input.text)"
              (textChange)="submit.className = input.text ? null : 'off'">
            </text-field>
            <i18n i18n="@@search" unit="search"></i18n>
            <grid-layout #submit ripple
              class="off"
              (tap)="input.text && navigate('/', 'search', input.text)">
              <icon-compat icon="chevron-circle-right"></icon-compat>
            </grid-layout>
          </absolute-layout>
        </stack-layout>
        <stack-layout ripple [class.active]="url === '/'" (tap)="navigate('/')">
          <icon-compat icon="play-circle"></icon-compat>
          <label [text]="name | async"></label>
        </stack-layout>
        <stack-layout ripple
          [class.active]="url.startsWith('/mapview')"
          (tap)="navigate('/', 'mapview')">
          <icon-compat icon="globe"></icon-compat>
          <i18n i18n="@@mapview" unit="mapview"></i18n>
        </stack-layout>
        <stack-layout ripple
          [class.active]="url.startsWith('/activities')"
          (tap)="navigate('/', 'activities')">
          <icon-compat icon="map-marker-alt"></icon-compat>
          <i18n i18n="@@activities" unit="activities"></i18n>
        </stack-layout>
        <stack-layout ripple
          [class.active]="url.startsWith('/organisations')"
          (tap)="navigate('/', 'organisations')">
          <icon-compat icon="at"></icon-compat>
          <i18n i18n="@@organisations" unit="organisations"></i18n>
        </stack-layout>
        <stack-layout ripple
          [class.active]="url.startsWith('/blogposts')"
          (tap)="navigate('/', 'blogposts')">
          <icon-compat icon="comment-dots"></icon-compat>
          <i18n i18n="@@blogposts" unit="blogposts"></i18n>
        </stack-layout>
        <stack-layout ripple
          [class.active]="url.startsWith('/infopages')"
          (tap)="navigate('/', 'infopages')">
          <icon-compat icon="info-circle"></icon-compat>
          <i18n i18n="@@infopages" unit="infopages"></i18n>
        </stack-layout>
        <!-- TODO: https://github.com/NativeScript/NativeScript/issues/6114 -->
        <stack-layout flexGrow="1"></stack-layout>
        <select-compat
          key="locale"
          [formControl]="language"
          [items]="languages">
          <stack-layout ripple>
            <icon-compat icon="language"></icon-compat>
            <i18n i18n="@@language" unit="language"></i18n>
          </stack-layout>
        </select-compat>
        <stack-layout ripple
          [class.active]="url.startsWith('/imprint')"
          (tap)="navigate('/', 'imprint')">
          <icon-compat icon="bullhorn"></icon-compat>
          <i18n i18n="@@imprint" unit="imprint"></i18n>
        </stack-layout>
        <stack-layout ripple
          [class.active]="url.startsWith('/policies')"
          (tap)="navigate('/', 'policies')">
          <icon-compat icon="balance-scale"></icon-compat>
          <i18n i18n="@@policies" unit="policies"></i18n>
        </stack-layout>
      </flexbox-layout>
    </scroll-view>
  </ng-template>
</drawer-compat>
